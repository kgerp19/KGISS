
@model KGERP.Data.CustomModel.CrmUploadListVm
@{
    ViewBag.Title = "Filtered Client List ";
    Layout = "~/Views/Shared/_LayoutCrm.cshtml";
    //int sl = 0;
    int sl = Model.FirstSerialNumber;
}

<style>
    .pagination {
        list-style-type: none;
        padding: 0;
        display: flex;
    }

        .pagination li {
            display: inline-block;
            margin: 0 5px;
        }

            .pagination li a {
                color: #333; /* Set the default color for pagination links */
                text-decoration: none;
                padding: 5px 10px;
            }

            .pagination li.active a {
                color: #fff; /* Set the color for the active pagination link */
                background-color: #007bff; /* Set the background color for the active link */
                border-radius: 5px;

            }
    .sear {
        display: flex;
        justify-content: flex-end;
        width: 100%;
    }
</style>
<section>
    <table>
        <tr>
            <td>
                <a href="@Url.Action("ExportClientExcel", "Crms", new
                                                {

                                                    GenderId = Model.GenderId,
                                                    ReligionId = Model.ReligionId,
                                                    ResponsibleOfficerId = Model.ResponsibleOfficerId,
                                                    ProjectId = Model.ProjectId,
                                                    TypeofInterestId = Model.TypeofInterestId,
                                                    StatusId = Model.StatusId,
                                                    SourceofMediaId = Model.SourceofMediaId,
                                                    OfferId = Model.OfferId,
                                                    ChoiceAreaId = Model.ChoiceAreaId,
                                                    lastUploadSerialNo = Model.lastUploadSerialNo,
                                                    companyId= Model.CompanyId
                                                })"
                   class="btn btn-sm btn-secondary">
                    <span class="glyphicon glyphicon-download"></span>  <i class="fa fa-file-excel"></i>  Export
                </a>
            </td>
        </tr>
    </table>
</section>
<section>
    <form action="" method="post">

        @Html.HiddenFor(model => model.CompanyId, new { id = "CompanyId" })
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Gender</label>
                    <select class="form-control" id="GenderId" name="GenderId" asp-for="GenderId">
                        <option value="">--select Gender--</option>
                        @foreach (var g in Model.GenderList)
                        {
                            if (g.Id == Model.GenderId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Religion</label>
                    <select class="form-control" id="ReligionId" name="ReligionId" asp-for="ReligionId">
                        <option value="">--select Religion--</option>
                        @foreach (var g in Model.ReligionList)
                        {
                            if (g.Id == Model.ReligionId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }

                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }
                        }
                    </select>
                </div>
            </div>


            @if (Model.IsLeader)
            {
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="control-label">Dealing Officer</label>
                        <select class="form-control" id="ResponsibleOfficerId" name="ResponsibleOfficerId" asp-for="ResponsibleOfficerId">
                            <option value="">--select Dealing Officer--</option>
                            @foreach (var g in Model.DealingOfficerList)
                            {
                                if (g.Id == Model.ResponsibleOfficerId)
                                {
                                    <option value="@g.Id" selected>@g.Name-@g.TeamName</option>
                                }
                                else
                                {
                                    <option value="@g.Id">@g.Name-@g.TeamName</option>
                                }

                            }
                        </select>
                    </div>
                </div>
            }
            else if (Model.ManagerId)
            {
                <div class="col-md-2">
                    <div class="form-group">
                        <label class="control-label">Dealing Officer</label>
                        <select class="form-control" id="ResponsibleOfficerId" name="ResponsibleOfficerId" asp-for="ResponsibleOfficerId">
                            <option value="">--select Dealing Officer--</option>
                            @foreach (var g in Model.DealingOfficerList)
                            {
                                if (g.Id == Model.ResponsibleOfficerId)
                                {
                                    <option value="@g.Id" selected>@g.Name-@g.TeamName</option>
                                }
                                else
                                {
                                    <option value="@g.Id">@g.Name-@g.TeamName</option>
                                }

                            }
                        </select>
                    </div>
                </div>
            }
            else
            {
                <span>&nbsp;</span>
            }


            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Project</label>
                    <select class="form-control" id="ProjectId" name="ProjectId" asp-for="ProjectId">
                        <option value="">--select Project--</option>
                        @foreach (var g in Model.ProjectList)
                        {
                            if (g.Id == Model.ProjectId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }

                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Type of Interest</label>
                    <select class="form-control" id="TypeofInterestId" name="TypeofInterestId" asp-for="TypeofInterestId">
                        <option value="">--select Interest --</option>
                        @foreach (var g in Model.TypeofInterestList)
                        {
                            if (g.Id == Model.TypeofInterestId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }

                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Service Status</label>
                    <select class="form-control" id="StatusId" name="StatusId" asp-for="StatusId">
                        <option value="">--select Choice of Area--</option>
                        @foreach (var g in Model.ServiceStatusList)
                        {
                            if (g.Id == Model.StatusId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }

                        }
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Source of Media</label>
                    <select class="form-control" id="SourceofMediaId" name="SourceofMediaId" asp-for="SourceofMediaId">
                        <option value="">--select Source of Media--</option>
                        @foreach (var g in Model.SourceofMediaList)
                        {
                            if (g.Id == Model.SourceofMediaId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }

                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Promotional Offer</label>
                    <select class="form-control" id="OfferId" name="OfferId" asp-for="OfferId">
                        <option value="">--select Promotional Offer--</option>
                        @foreach (var g in Model.PromotionalOfferList)
                        {
                            if (g.Id == Model.PromotionalOfferId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }


                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <label class="control-label">Choice of Area</label>
                    <select class="form-control" id="ChoiceAreaId" name="ChoiceAreaId" asp-for="ChoiceAreaId">
                        <option value="">--select Choice of Area--</option>
                        @foreach (var g in Model.ChoiceofAreaList)
                        {
                            if (g.Id == Model.ChoiceAreaId)
                            {
                                <option value="@g.Id" selected>@g.Name</option>
                            }
                            else
                            {
                                <option value="@g.Id">@g.Name</option>
                            }

                        }
                    </select>
                </div>
            </div>


            <div class="col-md-2 row">
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button type="submit" class="form-control bg-primary"><i class="fa fa-search"></i> &nbsp; Filter</button>

                </div>
            </div>

        </div>

    </form>
</section>
<div class="input-group sear">
    <div class="form-outline ">
        <input type="search" placeholder="search" id="AutSersinput" class="form-control" />
    </div>
    <button type="button" id="AutSers" class="btn btn-primary">
        <i class="fas fa-search"></i>
    </button>

</div>

<table class="table table-sm font-weight-normal table-striped " id="KgErpDataTablexyz123" style="margin-top:40px;">
    <thead style="background-color: #dcefe5;">
        <tr>
            <th class="p-1">S.L</th>
            <th class="p-1">Date</th>
            <th class="p-1"> Name</th>
            <th class="p-1">Mobile</th>
            <th class="p-1">Responsible Officer</th>
            <th class="p-1">Project</th>
            <th class="p-1">Type of Interest</th>
            <th class="p-1">Status Text</th>
            <th class="p-1">Source of Media</th>
            <th class="p-1">Organization </th>
            <th class="p-1">Job</th>
            <th class="p-1">Created Date</th>
            <th class="p-1">Action</th>


        </tr>
    </thead>
    <tbody>
        @foreach (var i in Model.DataList)
        {
            sl = sl + 1;
            <tr>
                <td class="p-1">@{ @sl}</td>
                <td class="p-1">@i.Createdate.ToString("dd-MMM-yyyy")</td>
                <td class="p-1 hvr-underline-from-left">

                    <a href="@Url.Action("GetClientDetailsById", "Crms", new {clientId= i.ClientId, companyId=i.CompanyId})"> @i.Name@*<i class="fa fa-info-circle"></i>*@</a>

                </td>
                <td class="p-1 text-center">
                    @i.MobileNo
                    <br />
                    <a href="https://wa.me/+88@(i.MobileNo)" target="_blank" rel="noopener noreferrer">
                        <i style="color: #25D366;" class="fab fa-whatsapp"></i>
                    </a>

                    <a class="ml-2" href="tel:@i.MobileNo">
                        <i class="fa fa-phone text-info "></i>
                    </a>
                </td>
                <td class="p-1">@i.ResponsibleOfficeName</td>
                <td class="p-1">@i.ProjectText</td>
                <td class="p-1">@i.TypeofInterestText</td>
                <td class="p-1">@i.StatusText</td>
                <td class="p-1">@i.SourceofMediaText</td>

                <td class="p-1">@i.OrganizationText</td>

                <td class="p-1">@i.JobTitle</td>
                <td class="p-1">@i.Createdate.ToString("dd/MM/yyyy")</td>
                <td class="p-1">
                    <a data-target="#detailModal" class="btn btn-sm btn-primary" onclick="clientDetail(@i.ClientId)"
                       data-toggle="modal" data-placement="top" title="Details">
                        <i class="fa fa-plus"></i> Details
                    </a>
                </td>

            </tr>
        }
    </tbody>

</table>

<div>
    Page @Model.CureentPage of @Model.totalPage
    @if (Model.totalPage > 1)
    {
        <ul class="pagination">
            @if (Model.CureentPage > 1)
            {
                <li><a href="javascript:void(0);" onclick="submitForm(@Model.CompanyId, @(Model.CureentPage - 1), @Model.pageSize)">Previous</a></li>
            }

            @if (Model.CureentPage > 6)
            {
                <li><a href="javascript:void(0);" onclick="submitForm(@Model.CompanyId, 1, @Model.pageSize)">1</a></li>
                <li>...</li>
            }

            @for (int i = Math.Max(1, Model.CureentPage - 5); i <= Math.Min(Model.totalPage, Model.CureentPage + 4); i++)
            {
                if (i == Model.CureentPage)
                {
                    <li class="active"><a href="javascript:void(0);" onclick="submitForm(@Model.CompanyId, @i, @Model.pageSize)">@i</a></li>
                }
                else
                {
                    <li><a href="javascript:void(0);" onclick="submitForm(@Model.CompanyId, @i, @Model.pageSize)">@i</a></li>
                }
            }

            @if (Model.CureentPage < Model.totalPage - 5)
            {
                <li>...</li>
                <li><a href="javascript:void(0);" onclick="submitForm(@Model.CompanyId, @Model.totalPage, @Model.pageSize)">@Model.totalPage</a></li>
            }

            @if (Model.CureentPage < Model.totalPage)
            {
                <li><a href="javascript:void(0);" onclick="submitForm(@Model.CompanyId, @(Model.CureentPage + 1), @Model.pageSize)">Next</a></li>
            }
        </ul>
    }
</div>

<form id="paginationForm" action="/Crms/ClientUpload" method="post" style="display:none;">
    <input type="hidden" name="companyId" id="formCompanyId">
    <input type="hidden" name="pageNumber" id="formPageNumber">
    <input type="hidden" name="pageSize" id="formPageSize">
    <input type="hidden" name="searchText" id="searchTextId">
</form>

<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Client Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-sm">
                    <tr>
                        <td>Name</td>
                        <td>:</td>
                        <td><p id="textclientName"></p></td>
                        <td>Gender</td>
                        <td>:</td>
                        <td><p id="textclientGender"></p></td>
                    </tr>
                    <tr>
                        <td>Mobile</td>
                        <td>:</td>
                        <td><p id="textclientMobile"></p></td>
                        <td>Mobile(2)</td>
                        <td>:</td>
                        <td><p id="textclientMobile2"></p></td>
                    </tr>
                    <tr>
                        <td>Email</td>
                        <td>:</td>
                        <td><p id="textclientEmail"></p></td>
                        <td>Email(2)</td>
                        <td>:</td>
                        <td><p id="textclientEmail2"></p></td>
                    </tr>
                    <tr>
                        <td>Religion</td>
                        <td>:</td>
                        <td><p id="textReligionText"></p></td>
                        <td>Date of Birth</td>
                        <td>:</td>
                        <td><p id="textDateofBirth"></p></td>
                    </tr>
                    <tr>
                        <td>Job Title</td>
                        <td>:</td>
                        <td><p id="textclientJobTitle"></p></td>
                        <td>Organization</td>
                        <td>:</td>
                        <td><p id="textclientOrganization"></p></td>
                    </tr>
                    <tr>
                        <td>Project</td>
                        <td>:</td>
                        <td><p id="textclientProject"></p></td>
                        <td>Status</td>
                        <td>:</td>
                        <td><p id="textclientStatus"></p></td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>
@section scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/cssjqryUi")
<script>
    function submitForm(companyId, pageNumber, pageSize, searchText) {
        if (searchText === undefined) {
            searchText = "";
        }
            document.getElementById("formCompanyId").value = companyId;
            document.getElementById("formPageNumber").value = pageNumber;
            document.getElementById("formPageSize").value = pageSize;
            document.getElementById("searchTextId").value = searchText;
            document.getElementById("paginationForm").submit();
        }
        $("#AutSers").click(function () {
            inputValue = $("#AutSersinput").val();

            localStorage.setItem("inputValue", inputValue);
            submitForm(@Model.CompanyId, @(Model.CureentPage + 1), @Model.pageSize, inputValue);
    //window.location.href = "/Crms/UserClientList?companyId=@Model.CompanyId&pageNumber=@(Model.CureentPage)&pageSize=" + pageeeee + "&searchText=" + encodeURIComponent(inputValue) + "";
});
    function clientDetail(clientId) {
            $.ajax({

                type: "GET",
                url: "@Url.Action("GetClientById", "Crms")",
                datatype: "Json",
                data: { clientId: clientId },
                success: function (data) {
                    console.log(data);
                    $('#textclientName').html(data.Name);
                    $('#textclientGender').html(data.GenderText);
                    $('#textReligionText').html(data.ReligionText);
                    $('#textDateofBirth').html(data.DateofBirth);

                    $('#textclientMobile').html(data.MobileNo);
                    $('#textclientMobileNo2').html(data.MobileNo2);
                    $('#textclientEmail').html(data.Email);
                    $('#textclientEmail2').html(data.Email2);
                    $('#textclientJobTitle').html(data.Email2);
                    $('#textclientOrganization').html(data.Email2);

                    $('#textclientProject').html(data.ProjectText);
                    $('#textclientStatus').html(data.StatusText);

                    $('#clientId').val(data.ClientId);
                    $('#companyId').val(data.CompanyId);
                }
            });
 }

</script>

}